(function(){"use strict";self.onmessage=U=>{const{cx:d,cz:x,SUBDIVISIONS:s,velikostMape:c,MAX_HEIGHT:f,heightData:h,colorData:V,fowData:_,VIDLJIVOST_FOW:k}=U.data,b=[],A=[],u=[],v=[],B=[],E=[],H=s/2,O=1,R=2;for(let n=0;n<=s;n++)for(let e=0;e<=s;e++){const t=e*O-H,p=n*O-H,o=e+d*s,i=n+x*s;let a=h[c-1-i]?.[o]??0;a*=f,b.push(t,a,p);const l=V[c-1-i]?.[o]??16777215,z=(l>>16&255)/255,M=(l>>8&255)/255,w=(l&255)/255;A.push(z,M,w,1);let g=_[c-1-i]?.[o]?1:k;const r=[0,0,0,0,0];l===65407?r[0]=g:l===3329330?r[1]=g:l===16772045||l===16768685?r[2]=g:l===255&&(r[4]=g),r[4]=1-g,v.push(r),B.push(e/R,n/R);const m=h[c-1-i]?.[o-1]??a/f,C=h[c-1-i]?.[o+1]??a/f,L=h[c-1-(i-1)]?.[o]??a/f,N=h[c-1-(i+1)]?.[o]??a/f,X=(C-m)*f,q=(N-L)*f;let D=-X,I=2,S=-q;const T=Math.sqrt(D*D+I*I+S*S);D/=T,I/=T,S/=T,E.push(D,I,S)}for(let n=0;n<s;n++)for(let e=0;e<s;e++){const t=n*(s+1)+e,p=e+d*s,o=n+x*s,i=h[c-1-o]?.[p]??0,a=h[c-1-o]?.[p+1]??0,l=h[c-1-(o+1)]?.[p]??0,z=h[c-1-(o+1)]?.[p+1]??0,M=Math.abs(i-z),w=Math.abs(a-l);M>w?(u.push(t,t+1,t+s+1),u.push(t+1,t+s+2,t+s+1)):(u.push(t,t+1,t+s+2),u.push(t,t+s+2,t+s+1))}self.postMessage({cx:d,cz:x,positions:b,colors:A,indices:u,weights:v,uvs:B,normals:E})}})();
